{"version":3,"sources":["modules/paragraphs_gridstack/es6/widget.es6"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","$","Drupal","settings","_gatherInfo","obj","jsonData","_drupalSettings$path","href","post","items","gridItems","jsonFieldData","uniqueKey","forEach","item","props","dataset","x","gsX","y","gsY","width","gsWidth","height","gsHeight","delta","push","find","text","gridStack","drupalSettings","path","baseUrl","pathPrefix","JSON","stringify","ajax","url","type","dataType","data","success","val","behaviors","gridstackField","attach","context","options","Object","values","value","field_id","gridstack","document","ready","parse","settingsKeys","keys","v","fieldGridstack","querySelectorAll","gridFields","observer","MutationObserver","mutations","mutation","target","getAttribute","itemBu","config","attributes","childList","characterData","gridHtml","observe","console","log","prependTo","onchange","jQuery"],"mappings":"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","file":"../widget.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n/**\n * @file\n * Provides GridStack loaders.\n */\n\n(function ($, Drupal, settings) {\n  'use strict';\n\n  var loaded = false;\n\n  /**\n   * Helper function.\n   *\n   * Add data to json field and send to drupal callback.\n   */\n  function _saveParagraphPosition(jsonData) {\n    var _drupalSettings$path = drupalSettings.path,\n        baseUrl = _drupalSettings$path.baseUrl,\n        pathPrefix = _drupalSettings$path.pathPrefix;\n\n    var href = \"\" + baseUrl + pathPrefix + \"grid_update\";\n    var post = \"grid_items=\" + JSON.stringify(jsonData);\n\n    // console.log('JSON.stringify(jsonData)', JSON.stringify(jsonData));\n\n    // Send data to drupal side.\n    $.ajax({\n      url: href,\n      type: \"POST\",\n      dataType: 'json',\n      data: post,\n      success: function success(data) {}\n    });\n    $('#edit-field-json-wrapper textarea').val(JSON.stringify(jsonData));\n  }\n\n  function _gatherInfo(obj) {\n    var items = obj.gridItems,\n        jsonFieldData = obj.jsonFieldData,\n        uniqueKey = obj.uniqueKey;\n\n\n    items.forEach(function (item) {\n      var props = item.dataset;\n      var obj = {\n        x: props.gsX,\n        y: props.gsY,\n        width: props.gsWidth,\n        height: props.gsHeight,\n        delta: props.delta\n      };\n\n      if (jsonFieldData.length === 0 || props.delta === jsonFieldData.length) {\n        jsonFieldData.items[uniqueKey].push(obj);\n      } else {\n        jsonFieldData.items[uniqueKey][props.delta] = {}; //@TODO ?????\n\n        jsonFieldData.items[uniqueKey][props.delta].x = props.gsX;\n        jsonFieldData.items[uniqueKey][props.delta].y = props.gsY;\n        jsonFieldData.items[uniqueKey][props.delta].width = props.gsWidth;\n        jsonFieldData.items[uniqueKey][props.delta].height = props.gsHeight;\n      }\n\n      // Update custom element with value of item height.\n      var height = props.gsHeight;\n      var $heightContainer = $(item).find('.height-counter');\n      height = 'Height: ' + height * 50 + 'px';\n      $heightContainer.text(height);\n    });\n\n    jsonFieldData.settings[uniqueKey] = settings.gridStack.settings[uniqueKey];\n\n    _saveParagraphPosition(jsonFieldData);\n  }\n\n  /**\n   * ---------------------------------------------------------------------------------------------\n   * @type {{}}\n   */\n\n  var options = {};\n\n  Drupal.behaviors.gridstackField = {\n    attach: function attach(context, settings) {\n      var options = {};\n      // Gridstack init.\n      if (typeof settings.gridStack !== 'undefined') {\n        options = settings.gridStack.settings;\n        options = Object.values(options);\n        options.forEach(function (value) {\n          $('.grid-stack[fid = ' + value.field_id + ']').gridstack(value);\n        });\n      }\n    }\n  };\n\n  $(document).ready(function () {\n    var data = $('#edit-field-json-wrapper textarea').val();\n    if (data.length) {\n      data = JSON.parse(data);\n      var settingsKeys = Object.keys(data.settings);\n      var settingsValues = Object.values(data.settings);\n\n      settingsValues.forEach(function (v, i) {\n        $('.grid-stack[fid = ' + settingsKeys[i] + ']').gridstack(v);\n      });\n    }\n  });\n\n  var fieldGridstack = document.querySelectorAll('.grid-stack');\n\n  var jsonFieldData = {};\n\n  // Fill in JSON field with parameters from grid items.\n  if (fieldGridstack.length) {}\n\n  // Create obj structure.\n  jsonFieldData.items = {};\n  jsonFieldData.settings = options;\n  // jsonFieldData.fid = fid;\n\n\n  // выбираем целевой элемент\n  var gridFields = document.querySelectorAll('.field--widget-paragraphs-gridstack-widget');\n\n  // создаём экземпляр MutationObserver\n  // Insert/remove dom elements event listener.\n  var observer = new MutationObserver(function (mutations) {\n    mutations.forEach(function (mutation) {\n      var gridItems = mutation.target.querySelectorAll('.grid-stack-item.ui-draggable.ui-resizable');\n\n      var uniqueKey = mutation.target.querySelectorAll('.form-item-grid')[0].getAttribute('fid');\n      jsonFieldData.items[uniqueKey] = {};\n\n      _gatherInfo({ gridItems: gridItems, jsonFieldData: jsonFieldData, uniqueKey: uniqueKey });\n\n      // DO SOMETHING ON INSERT/DELETE.\n      gridItems.forEach(function (itemBu) {\n        // DO SOMETHING ON INSERT/DELETE.\n      });\n    });\n  });\n\n  // конфигурация нашего observer:\n  var config = { attributes: true, childList: true, characterData: true };\n\n  // передаём в качестве аргументов целевой элемент и его конфигурацию\n  gridFields.forEach(function (gridHtml) {\n    var uniqueKey = gridHtml.querySelectorAll('.form-item-grid')[0].getAttribute('fid');\n    var gridItems = gridHtml.querySelectorAll('.grid-stack-item.ui-draggable.ui-resizable');\n    jsonFieldData.items[uniqueKey] = [];\n\n    // Observe insert/remove events.\n    observer.observe(gridHtml, config);\n\n    // Add custom element with value of item height.\n    if (gridItems.length) {\n      gridItems.forEach(function (item) {\n        console.log('ADD CUSTOM HEIGHT ITEM', item);\n        var height = $(item).data('gs-height');\n        height = 'Height: ' + height * 50 + 'px';\n        $(item).prependTo('<div class=\"height-counter\">' + height + '</div>');\n      });\n    }\n\n    // Other change events.\n    gridHtml.onchange = function (item) {\n      var gridItems = item.target.querySelectorAll('.grid-stack-item.ui-draggable.ui-resizable');\n\n      _gatherInfo({ gridItems: gridItems, jsonFieldData: jsonFieldData, uniqueKey: uniqueKey });\n\n      gridItems.forEach(function (itemBu) {\n        // DO THOMETHING ON CHANGE\n      });\n    };\n  });\n})(jQuery, Drupal, drupalSettings);\n\n},{}]},{},[1]);\n"]}